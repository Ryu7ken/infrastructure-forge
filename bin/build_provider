#! /usr/bin/bash

PLUGIN_DIR="c:/Users/Baquiur/Documents/terraform-bootcamp/.terraform.d/plugins/local.providers/local/terratowns/1.0.0/"
PLUGIN_NAME="terraform-provider-terratowns_v1.0.0"
PROJECT_ROOT_DIR="c:/Users/Baquiur/Documents/terraform-bootcamp/"

# https://servian.dev/terraform-local-providers-and-registry-mirror-configuration-b963117dfffa
cd $PROJECT_ROOT_DIR/terraform-provider-terratowns
cp $PROJECT_ROOT_DIR/terraformrc $PROJECT_ROOT_DIR/.terraformrc
rm -rf $PROJECT_ROOT_DIR/.terraform.d/plugins
rm -rf $PROJECT_ROOT_DIR/.terraform
rm -rf $PROJECT_ROOT_DIR/.terraform.lock.hcl
go build -o $PLUGIN_NAME
mkdir -p $PLUGIN_DIR/x86_64/
mkdir -p $PLUGIN_DIR/linux_amd64/
cp $PLUGIN_NAME $PLUGIN_DIR/x86_64
cp $PLUGIN_NAME $PLUGIN_DIR/linux_amd64